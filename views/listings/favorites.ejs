
<% layout('layouts/boilerplate') %>

<div class="container mt-4">
  <h3 class="fw-bold mb-4">My Favorite Listings</h3>

  <% if (!favorites || favorites.length === 0) { %>
    <div class="alert alert-info text-center">
      You have no favorite listings yet.
    </div>
  <% } else { %>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4">
      <% favorites.forEach(listing => { %>
        <div class="col">
          <div class="card h-100 shadow-sm border-0 position-relative listing-card">

            <!-- Favorite Heart Button -->
            <form action="/listings/<%= listing._id %>/favorite" method="POST" class="favorite-form position-absolute top-0 end-0 m-2" style="z-index:10;">
              <button type="submit" class="btn btn-link p-0" aria-label="Toggle Favorite">
                <!-- Since these are favorites, heart is always filled -->
                <i class="fas fa-heart fs-5 text-danger"></i>
              </button>
            </form>

            <!-- Clickable Listing -->
            <a href="/listings/<%= listing._id %>" class="text-decoration-none text-dark">
              <img 
                src="<%= listing.image?.url || 'https://via.placeholder.com/400x300?text=No+Image' %>" 
                class="card-img-top" 
                alt="Listing image"
                style="height: 16rem; object-fit: cover;"
              >
              <div class="card-body">
                <h5 class="card-title mb-1"><%= listing.title %></h5>
                <p class="card-text text-muted mb-0">
                  â‚¹ <%= typeof listing.price === 'number' ? listing.price.toLocaleString("en-IN") : 'N/A' %> / night
                </p>
                <small class="text-muted"><%= listing.location %>, <%= listing.country %></small>
              </div>
            </a>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>

<!-- Prevent Heart Button from Triggering Link -->
<script>
  document.querySelectorAll(".favorite-form").forEach(form => {
    form.addEventListener("click", function (e) {
      e.stopPropagation();
    });
  });
</script>

<!-- Styles (you can also move to your CSS file) -->
<style>
.listing-card:hover {
  transform: translateY(-2px);
  transition: all 0.2s ease-in-out;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
}
.favorite-form button {
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
}
.favorite-form button:focus {
  outline: none;
}



</style>
