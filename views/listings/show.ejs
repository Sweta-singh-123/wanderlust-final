<% layout('layouts/boilerplate') %>

<div class="container mt-4">
  <div class="card shadow">
    <% if (listing.image?.url) { %>
      <img src="<%= listing.image.url %>" class="card-img-top img-fluid" alt="Listing Image" style="max-height: 400px; object-fit: cover;">
    <% } else { %>
      <img src="https://via.placeholder.com/600x400?text=No+Image" class="card-img-top img-fluid" alt="No Image" style="max-height: 400px; object-fit: cover;">
    <% } %>

    <div class="card-body">
      <h2 class="card-title mb-3"><%= listing.title %></h2>
      <p class="card-text"><%= listing.description %></p>
      <h4 class="text-success mb-2">‚Çπ <%= typeof listing.price === 'number' ? listing.price.toLocaleString("en-IN") : 'N/A' %></h4>
      <p class="text-muted mb-4"><%= listing.location %></p>

      <div class="mb-4">
        <a href="/listings" class="btn btn-secondary me-2">‚¨Ö Back</a>
        <a href="/listings/<%= listing._id %>/edit" class="btn btn-warning me-2">‚úèÔ∏è Edit</a>
       
      <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST" style="display: inline; margin: 0; padding: 0;">
      <button type="submit" class="btn btn-danger">Delete</button>
        </form>

        <a href="/listings/<%= listing._id %>/reviews/new" class="btn btn-success">‚úçÔ∏è Write a Review</a>
      </div>

      <hr />
      <h4>User Reviews <span class="badge bg-primary"><%= listing.reviews.length %></span></h4>

      <% if (listing.reviews.length === 0) { %>
        <p>No reviews yet. Be the first to review!</p>
      <% } else { %>
        <ul class="list-group">
          <% listing.reviews.forEach(review => { %>
            <li class="list-group-item">
              <strong><%= review.author %></strong>
              <% for (let i = 0; i < 5; i++) { %>
                <% if (i < review.rating) { %>
                  <i class="fa-solid fa-star text-warning"></i>
                <% } else { %>
                  <i class="fa-regular fa-star text-warning"></i>
                <% } %>
              <% } %>
              <p class="mt-1 mb-1"><%= review.comment %></p>
              <small class="text-muted"><%= new Date(review.createdAt).toLocaleDateString() %></small>
              <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST" class="mt-2">
                <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this review?')">üóë Delete Review</button>
              </form>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>
  </div>
</div>


